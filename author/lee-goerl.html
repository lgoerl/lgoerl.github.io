<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Data and science - Lee Goerl</title>
        <link rel="stylesheet" href="https://lgoerl.github.io/theme/css/main.css" />
        <link href="https://lgoerl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Data and science Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://lgoerl.github.io/">Data and science </a></h1>
                <nav><ul>
                    <li><a href="https://lgoerl.github.io/">Lee Goerl</a></li>
                    <li><a href="https://lgoerl.github.io/category/posts.html">posts</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://lgoerl.github.io/spark-overflow-analysis.html">Analyzing StackOverflow with Apache Spark</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-06-09T18:15:00-07:00">
                Published: Fri 09 June 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://lgoerl.github.io/author/lee-goerl.html">Lee Goerl</a>
        </address>
<p>In <a href="https://lgoerl.github.io/category/posts.html">posts</a>.</p>
<p>tags: <a href="https://lgoerl.github.io/tag/personal.html">personal</a> <a href="https://lgoerl.github.io/tag/projects.html">projects</a> <a href="https://lgoerl.github.io/tag/tutorials.html">tutorials</a> <a href="https://lgoerl.github.io/tag/code.html">code</a> <a href="https://lgoerl.github.io/tag/spark.html">spark</a> </p>
</footer><!-- /.post-info --><style type="text/css">/*!
*
* IPython notebook
*
*/
/* CSS font colors for translated ANSI colors. */
.ansibold {
  font-weight: bold;
}
/* use dark versions for foreground, to improve visibility */
.ansiblack {
  color: black;
}
.ansired {
  color: darkred;
}
.ansigreen {
  color: darkgreen;
}
.ansiyellow {
  color: #c4a000;
}
.ansiblue {
  color: darkblue;
}
.ansipurple {
  color: darkviolet;
}
.ansicyan {
  color: steelblue;
}
.ansigray {
  color: gray;
}
/* and light for background, for the same reason */
.ansibgblack {
  background-color: black;
}
.ansibgred {
  background-color: red;
}
.ansibggreen {
  background-color: green;
}
.ansibgyellow {
  background-color: yellow;
}
.ansibgblue {
  background-color: blue;
}
.ansibgpurple {
  background-color: magenta;
}
.ansibgcyan {
  background-color: cyan;
}
.ansibggray {
  background-color: gray;
}
div.cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  border-radius: 2px;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  border-width: 1px;
  border-style: solid;
  border-color: transparent;
  width: 100%;
  padding: 5px;
  /* This acts as a spacer between cells, that is outside the border */
  margin: 0px;
  outline: none;
  border-left-width: 1px;
  padding-left: 5px;
  background: linear-gradient(to right, transparent -40px, transparent 1px, transparent 1px, transparent 100%);
}
div.cell.jupyter-soft-selected {
  border-left-color: #90CAF9;
  border-left-color: #E3F2FD;
  border-left-width: 1px;
  padding-left: 5px;
  border-right-color: #E3F2FD;
  border-right-width: 1px;
  background: #E3F2FD;
}
@media print {
  div.cell.jupyter-soft-selected {
    border-color: transparent;
  }
}
div.cell.selected {
  border-color: #ababab;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 5px, transparent 5px, transparent 100%);
}
@media print {
  div.cell.selected {
    border-color: transparent;
  }
}
div.cell.selected.jupyter-soft-selected {
  border-left-width: 0;
  padding-left: 6px;
  background: linear-gradient(to right, #42A5F5 -40px, #42A5F5 7px, #E3F2FD 7px, #E3F2FD 100%);
}
.edit_mode div.cell.selected {
  border-color: #66BB6A;
  border-left-width: 0px;
  padding-left: 6px;
  background: linear-gradient(to right, #66BB6A -40px, #66BB6A 5px, transparent 5px, transparent 100%);
}
@media print {
  .edit_mode div.cell.selected {
    border-color: transparent;
  }
}
.prompt {
  /* This needs to be wide enough for 3 digit prompt numbers: In[100]: */
  min-width: 14ex;
  /* This padding is tuned to match the padding on the CodeMirror editor. */
  padding: 0.4em;
  margin: 0px;
  font-family: monospace;
  text-align: right;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
  /* Don't highlight prompt number selection */
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  /* Use default cursor */
  cursor: default;
}
@media (max-width: 540px) {
  .prompt {
    text-align: left;
  }
}
div.inner_cell {
  min-width: 0;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_area {
  border: 1px solid #cfcfcf;
  border-radius: 2px;
  background: #f7f7f7;
  line-height: 1.21429em;
}
/* This is needed so that empty prompt areas can collapse to zero height when there
   is no content in the output_subarea and the prompt. The main purpose of this is
   to make sure that empty JavaScript output_subareas have no height. */
div.prompt:empty {
  padding-top: 0;
  padding-bottom: 0;
}
div.unrecognized_cell {
  padding: 5px 5px 5px 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.unrecognized_cell .inner_cell {
  border-radius: 2px;
  padding: 5px;
  font-weight: bold;
  color: red;
  border: 1px solid #cfcfcf;
  background: #eaeaea;
}
div.unrecognized_cell .inner_cell a {
  color: inherit;
  text-decoration: none;
}
div.unrecognized_cell .inner_cell a:hover {
  color: inherit;
  text-decoration: none;
}
@media (max-width: 540px) {
  div.unrecognized_cell > div.prompt {
    display: none;
  }
}
div.code_cell {
  /* avoid page breaking on code cells when printing */
}
@media print {
  div.code_cell {
    page-break-inside: avoid;
  }
}
/* any special styling for code cells that are currently running goes here */
div.input {
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.input {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
/* input_area and input_prompt must match in top border and margin for alignment */
div.input_prompt {
  color: #303F9F;
  border-top: 1px solid transparent;
}
div.input_area > div.highlight {
  margin: 0.4em;
  border: none;
  padding: 0px;
  background-color: transparent;
}
div.input_area > div.highlight > pre {
  margin: 0px;
  border: none;
  padding: 0px;
  background-color: transparent;
}
/* The following gets added to the <head> if it is detected that the user has a
 * monospace font with inconsistent normal/bold/italic height.  See
 * notebookmain.js.  Such fonts will have keywords vertically offset with
 * respect to the rest of the text.  The user should select a better font.
 * See: https://github.com/ipython/ipython/issues/1503
 *
 * .CodeMirror span {
 *      vertical-align: bottom;
 * }
 */
.CodeMirror {
  line-height: 1.21429em;
  /* Changed from 1em to our global default */
  font-size: 14px;
  height: auto;
  /* Changed to auto to autogrow */
  background: none;
  /* Changed from white to allow our bg to show through */
}
.CodeMirror-scroll {
  /*  The CodeMirror docs are a bit fuzzy on if overflow-y should be hidden or visible.*/
  /*  We have found that if it is visible, vertical scrollbars appear with font size changes.*/
  overflow-y: hidden;
  overflow-x: auto;
}
.CodeMirror-lines {
  /* In CM2, this used to be 0.4em, but in CM3 it went to 4px. We need the em value because */
  /* we have set a different line-height and want this to scale with that. */
  padding: 0.4em;
}
.CodeMirror-linenumber {
  padding: 0 8px 0 4px;
}
.CodeMirror-gutters {
  border-bottom-left-radius: 2px;
  border-top-left-radius: 2px;
}
.CodeMirror pre {
  /* In CM3 this went to 4px from 0 in CM2. We need the 0 value because of how we size */
  /* .CodeMirror-lines */
  padding: 0;
  border: 0;
  border-radius: 0;
}
/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>
Adapted from GitHub theme

*/
.highlight-base {
  color: #000;
}
.highlight-variable {
  color: #000;
}
.highlight-variable-2 {
  color: #1a1a1a;
}
.highlight-variable-3 {
  color: #333333;
}
.highlight-string {
  color: #BA2121;
}
.highlight-comment {
  color: #408080;
  font-style: italic;
}
.highlight-number {
  color: #080;
}
.highlight-atom {
  color: #88F;
}
.highlight-keyword {
  color: #008000;
  font-weight: bold;
}
.highlight-builtin {
  color: #008000;
}
.highlight-error {
  color: #f00;
}
.highlight-operator {
  color: #AA22FF;
  font-weight: bold;
}
.highlight-meta {
  color: #AA22FF;
}
/* previously not defined, copying from default codemirror */
.highlight-def {
  color: #00f;
}
.highlight-string-2 {
  color: #f50;
}
.highlight-qualifier {
  color: #555;
}
.highlight-bracket {
  color: #997;
}
.highlight-tag {
  color: #170;
}
.highlight-attribute {
  color: #00c;
}
.highlight-header {
  color: blue;
}
.highlight-quote {
  color: #090;
}
.highlight-link {
  color: #00c;
}
/* apply the same style to codemirror */
.cm-s-ipython span.cm-keyword {
  color: #008000;
  font-weight: bold;
}
.cm-s-ipython span.cm-atom {
  color: #88F;
}
.cm-s-ipython span.cm-number {
  color: #080;
}
.cm-s-ipython span.cm-def {
  color: #00f;
}
.cm-s-ipython span.cm-variable {
  color: #000;
}
.cm-s-ipython span.cm-operator {
  color: #AA22FF;
  font-weight: bold;
}
.cm-s-ipython span.cm-variable-2 {
  color: #1a1a1a;
}
.cm-s-ipython span.cm-variable-3 {
  color: #333333;
}
.cm-s-ipython span.cm-comment {
  color: #408080;
  font-style: italic;
}
.cm-s-ipython span.cm-string {
  color: #BA2121;
}
.cm-s-ipython span.cm-string-2 {
  color: #f50;
}
.cm-s-ipython span.cm-meta {
  color: #AA22FF;
}
.cm-s-ipython span.cm-qualifier {
  color: #555;
}
.cm-s-ipython span.cm-builtin {
  color: #008000;
}
.cm-s-ipython span.cm-bracket {
  color: #997;
}
.cm-s-ipython span.cm-tag {
  color: #170;
}
.cm-s-ipython span.cm-attribute {
  color: #00c;
}
.cm-s-ipython span.cm-header {
  color: blue;
}
.cm-s-ipython span.cm-quote {
  color: #090;
}
.cm-s-ipython span.cm-link {
  color: #00c;
}
.cm-s-ipython span.cm-error {
  color: #f00;
}
.cm-s-ipython span.cm-tab {
  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=);
  background-position: right;
  background-repeat: no-repeat;
}
div.output_wrapper {
  /* this position must be relative to enable descendents to be absolute within it */
  position: relative;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  z-index: 1;
}
/* class for the output area when it should be height-limited */
div.output_scroll {
  /* ideally, this would be max-height, but FF barfs all over that */
  height: 24em;
  /* FF needs this *and the wrapper* to specify full width, or it will shrinkwrap */
  width: 100%;
  overflow: auto;
  border-radius: 2px;
  -webkit-box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.8);
  display: block;
}
/* output div while it is collapsed */
div.output_collapsed {
  margin: 0px;
  padding: 0px;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
div.out_prompt_overlay {
  height: 100%;
  padding: 0px 0.4em;
  position: absolute;
  border-radius: 2px;
}
div.out_prompt_overlay:hover {
  /* use inner shadow to get border that is computed the same on WebKit/FF */
  -webkit-box-shadow: inset 0 0 1px #000;
  box-shadow: inset 0 0 1px #000;
  background: rgba(240, 240, 240, 0.5);
}
div.output_prompt {
  color: #D84315;
}
/* This class is the outer container of all output sections. */
div.output_area {
  padding: 0px;
  page-break-inside: avoid;
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
div.output_area .MathJax_Display {
  text-align: left !important;
}
div.output_area 
div.output_area 
div.output_area img,
div.output_area svg {
  max-width: 100%;
  height: auto;
}
div.output_area img.unconfined,
div.output_area svg.unconfined {
  max-width: none;
}
/* This is needed to protect the pre formating from global settings such
   as that of bootstrap */
.output {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: vertical;
  -moz-box-align: stretch;
  display: box;
  box-orient: vertical;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.output_area {
    /* Old browsers */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-box-align: stretch;
    display: -moz-box;
    -moz-box-orient: vertical;
    -moz-box-align: stretch;
    display: box;
    box-orient: vertical;
    box-align: stretch;
    /* Modern browsers */
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }
}
div.output_area pre {
  margin: 0;
  padding: 0;
  border: 0;
  vertical-align: baseline;
  color: black;
  background-color: transparent;
  border-radius: 0;
}
/* This class is for the output subarea inside the output_area and after
   the prompt div. */
div.output_subarea {
  overflow-x: auto;
  padding: 0.4em;
  /* Old browsers */
  -webkit-box-flex: 1;
  -moz-box-flex: 1;
  box-flex: 1;
  /* Modern browsers */
  flex: 1;
  max-width: calc(100% - 14ex);
}
div.output_scroll div.output_subarea {
  overflow-x: visible;
}
/* The rest of the output_* classes are for special styling of the different
   output types */
/* all text output has this class: */
div.output_text {
  text-align: left;
  color: #000;
  /* This has to match that of the the CodeMirror class line-height below */
  line-height: 1.21429em;
}
/* stdout/stderr are 'text' as well as 'stream', but execute_result/error are *not* streams */
div.output_stderr {
  background: #fdd;
  /* very light red background for stderr */
}
div.output_latex {
  text-align: left;
}
/* Empty output_javascript divs should have no height */
div.output_javascript:empty {
  padding: 0;
}
.js-error {
  color: darkred;
}
/* raw_input styles */
div.raw_input_container {
  line-height: 1.21429em;
  padding-top: 5px;
}
pre.raw_input_prompt {
  /* nothing needed here. */
}
input.raw_input {
  font-family: monospace;
  font-size: inherit;
  color: inherit;
  width: auto;
  /* make sure input baseline aligns with prompt */
  vertical-align: baseline;
  /* padding + margin = 0.5em between prompt and cursor */
  padding: 0em 0.25em;
  margin: 0em 0.25em;
}
input.raw_input:focus {
  box-shadow: none;
}
p.p-space {
  margin-bottom: 10px;
}
div.output_unrecognized {
  padding: 5px;
  font-weight: bold;
  color: red;
}
div.output_unrecognized a {
  color: inherit;
  text-decoration: none;
}
div.output_unrecognized a:hover {
  color: inherit;
  text-decoration: none;
}
.rendered_html {
  color: #000;
  /* any extras will just be numbers: */
}



.rendered_html :link {
  text-decoration: underline;
}
.rendered_html :visited {
  text-decoration: underline;
}






.rendered_html h1:first-child {
  margin-top: 0.538em;
}
.rendered_html h2:first-child {
  margin-top: 0.636em;
}
.rendered_html h3:first-child {
  margin-top: 0.777em;
}
.rendered_html h4:first-child {
  margin-top: 1em;
}
.rendered_html h5:first-child {
  margin-top: 1em;
}
.rendered_html h6:first-child {
  margin-top: 1em;
}








.rendered_html * + ul {
  margin-top: 1em;
}
.rendered_html * + ol {
  margin-top: 1em;
}


.rendered_html pre,



.rendered_html tr,
.rendered_html th,

.rendered_html td,


.rendered_html * + table {
  margin-top: 1em;
}

.rendered_html * + p {
  margin-top: 1em;
}

.rendered_html * + img {
  margin-top: 1em;
}
.rendered_html img,

.rendered_html img.unconfined,

div.text_cell {
  /* Old browsers */
  display: -webkit-box;
  -webkit-box-orient: horizontal;
  -webkit-box-align: stretch;
  display: -moz-box;
  -moz-box-orient: horizontal;
  -moz-box-align: stretch;
  display: box;
  box-orient: horizontal;
  box-align: stretch;
  /* Modern browsers */
  display: flex;
  flex-direction: row;
  align-items: stretch;
}
@media (max-width: 540px) {
  div.text_cell > div.prompt {
    display: none;
  }
}
div.text_cell_render {
  /*font-family: "Helvetica Neue", Arial, Helvetica, Geneva, sans-serif;*/
  outline: none;
  resize: none;
  width: inherit;
  border-style: none;
  padding: 0.5em 0.5em 0.5em 0.4em;
  color: #000;
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
}
a.anchor-link:link {
  text-decoration: none;
  padding: 0px 20px;
  visibility: hidden;
}
h1:hover .anchor-link,
h2:hover .anchor-link,
h3:hover .anchor-link,
h4:hover .anchor-link,
h5:hover .anchor-link,
h6:hover .anchor-link {
  visibility: visible;
}
.text_cell.rendered .input_area {
  display: none;
}
.text_cell.rendered 
.text_cell.unrendered .text_cell_render {
  display: none;
}
.cm-header-1,
.cm-header-2,
.cm-header-3,
.cm-header-4,
.cm-header-5,
.cm-header-6 {
  font-weight: bold;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}
.cm-header-1 {
  font-size: 185.7%;
}
.cm-header-2 {
  font-size: 157.1%;
}
.cm-header-3 {
  font-size: 128.6%;
}
.cm-header-4 {
  font-size: 110%;
}
.cm-header-5 {
  font-size: 100%;
  font-style: italic;
}
.cm-header-6 {
  font-size: 100%;
  font-style: italic;
}
</style>
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
<style type="text/css">
/* Temporary definitions which will become obsolete with Notebook release 5.0 */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="A-little-about-Apache-Spark">A little about Apache Spark<a class="anchor-link" href="#A-little-about-Apache-Spark">¶</a></h1><p>The amount of experience I have with Spark is not substancial, but something is better than nothing. I've had the opportunity to leverage the Spark platform on what I think is a really cool dataset, and one that's relevant to me: StackOverflow. I'm going to go through the analysis with some code later, but first, to remind myself, some basics from the documentation.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Vocab">Vocab<a class="anchor-link" href="#Vocab">¶</a></h2><p><strong>Spark</strong> - Like Hadoop, Spark is a lowlevel framework for distributed data analysis, except better. Spark does most of its work in memory, instead of persistently persisting to disk. It also has more support for common python analysis packages.</p>
<p><strong>RDD</strong> - Resilient Distributed Datasets - these are like lists, but <em>resilient.</em> Heheheh. They're like lists, but distributed. They can be lists of many things: typical datatypes, dictionaries, or objects (v convenient). Use <code>sc.parallelize(any_list)</code> to load any list into the parallelization.</p>
<p><strong>Shared variables</strong> These come in two flavors, which you could probably predict if you've used Hadoop.</p>
<ul>
<li>Broadcast variables - think of as static variables whose value is sent to all the nodes in the parallelization <em>one variable to many nodes</em></li>
<li>Accumulator variables - variables into which values from the RDD are being accumulated independently from all nodes <em>many nodes to one variable</em> </li>
</ul>
<p>Next we have the <em>verbs</em> with which we can act on RDDs.</p>
<p><strong>Transformations</strong> - a transformation takes an RDD and returns another RDD. Typical transformations are things like, a column selector, or a mathetmatical transformation on a column. We use</p>
<ul>
<li><code>map</code>, <code>flatmap</code>, <code>sample</code>, <code>filter</code>, <code>join</code>, <code>groupByKey</code>, <code>reduceByKey</code>, <code>aggregateByKey</code> and <code>countByKey</code>. </li>
<li>Usually, a <code>lambda</code> function accompanies the use of <code>map</code> or <code>flatmap</code>, <code>reduceByKey</code> or <code>aggregateByKey</code>. </li>
</ul>
<p>Note, <code>reduceByKey</code> and <code>aggregateByKey</code> are different.</p>
<p><strong>Actions</strong> - a type of transformation that returns a <em>value</em> instead of another RDD (could be a list, dictionary, etc). Examples include</p>
<ul>
<li><code>reduce</code>, <code>count</code>, <code>take(n)</code>, <code>takeOrdered(n,[ordering])</code>, <code>first</code></li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Examples">Examples<a class="anchor-link" href="#Examples">¶</a></h1><p>As I said, the dataset is a collection of <a href="https://stackoverflow.com/">Stack Overflow</a> data: questions, answers, and user data. We're going to mostly do a mixture of exploratory data aggregation, tricky feature extraction, and train a model. Specifically:</p>
<ul>
<li>Investigate users' reputation by considering the types of posts they make (question or answer),</li>
<li>Investigate the realtionship between user reputation and tenure (by post-count),</li>
<li>Investigate if the reception of the users' first question has an effect on if they're active 100-150 days from account creation,</li>
<li>Use Dataframes and SparkML's to train a <code>Word2Vec</code> model and find terms related to "ggplot2" by considering cosine similarity scores,</li>
<li>Use the <code>Word2Vec</code> model to cluster questions,</li>
<li>Predict tags of a question from the body text.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Data-Itself">The Data Itself<a class="anchor-link" href="#The-Data-Itself">¶</a></h2><p>There are three datasets, each broken into many parts, and having been stored and extracted in their own folder. All the data are in the form of json objects inside xml files; each line is an entry. For each of the three datasets, listed below is an example of data found in a line of each.</p>
<h3 id="allPosts">allPosts<a class="anchor-link" href="#allPosts">¶</a></h3>
<pre><code>'ViewCount': '223',
'Title': 'Formula to discard items by votes (Lower bound of Wilson score confidence interval)', 
'LastEditDate': '2011-06-02T22:10:16.550', 
'AnswerCount': '0', 
'Score': '2', 
'OwnerDisplayName': 'metrobalderas', 
'PostTypeId': '1', 
'OwnerUserId': '4638', 
'FavoriteCount': '0', 
'Body': u'<p>I\'m developing an application in which users can create \'sections\' (\xe0 la subreddit in reddit), in which items/posts can be created and voted with a thumbs-up/down system.</p>\n\n<p><a href="http://www.evanmiller.org/how-not-to-sort-by-average-rating.html" rel="nofollow">A great article</a> guided me on how to sort these votes so that an item with a 100% positive response but with few votes won\'t get ranked over one with hundreds of votes and an acceptance of 80%. The article describes it pretty well.</p>\n\n<p>However, I\'d like to discard the lowest-ranked items and this is where it gets tricky:</p>\n\n<ul>\n<li>How could I know the minimum number of votes in order to discard it?</li>\n<li>What is the score\'s threshold required to discard the item?</li>\n</ul>\n\n<p>As I said, there are sections, and each one has items (which are the ones voted). The formula has to take into consideration the fact that one section may have 100 items with thousands of votes and another might have 3 or 4 items with 20 votes, so a minimum of 40 votes required might be optimal for the first case but totally out of bounds for the second.</p>\n\n<p>(I was tempted in posting this to MathOverflow, but I\'m not really sure since this also involves some programming)</p>\n\n<p>Thanks!</p>\n', 
'Tags': '<confidence-interval>', 
'LastEditorUserId': '88', 
'LastActivityDate': '2011-06-02T22:10:16.550', 
'CommentCount': '0', 
'CreationDate': '2011-05-16T17:39:58.170', 'Id': '10893'}</code></pre>
<h3 id="allUsers">allUsers<a class="anchor-link" href="#allUsers">¶</a></h3>
<pre><code>{'DisplayName': 'Lars Reeker', 
'Views': '0', 
'DownVotes': '0', 
'LastAccessDate': '2015-03-02T18:42:20.510', 
'ProfileImageUrl': 'https://lh3.googleusercontent.com/-Y7GNsydm-mc/AAAAAAAAAAI/AAAAAAAADq8/15o5t99O5IU/photo.jpg', 
'Reputation': '1', 
'UpVotes': '0', 
'CreationDate': '2015-03-02T18:42:20.510', 
'Id': '70185', 
'AccountId': '5872878'}</code></pre>
<h3 id="allVotes">allVotes<a class="anchor-link" href="#allVotes">¶</a></h3>
<pre><code>{'VoteTypeId': '2', 
'PostId': '2350', 
'CreationDate': '2013-05-23T00:00:00.000', 
'Id': '221084'}</code></pre>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preliminaries">Preliminaries<a class="anchor-link" href="#Preliminaries">¶</a></h2><p>Loading packages and data.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkContext</span>
<span class="kn">import</span> <span class="nn">pyspark</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="s2">"local[*]"</span><span class="p">,</span> <span class="s2">"temp"</span><span class="p">)</span>

<span class="n">postsPath</span> <span class="o">=</span> <span class="s1">'/allPosts'</span>
<span class="n">usersPath</span> <span class="o">=</span> <span class="s1">'/allUsers'</span>
<span class="n">votesPath</span> <span class="o">=</span> <span class="s1">'/allVotes'</span>

<span class="k">def</span> <span class="nf">datapath</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">'file:///PATH-TO-PARENT-FOLDER'</span> <span class="o">+</span> <span class="n">path</span>

<span class="n">allvotes</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">datapath</span><span class="p">(</span><span class="s1">'allVotes/'</span><span class="p">))</span>
<span class="n">allposts</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">datapath</span><span class="p">(</span><span class="s1">'allPosts/'</span><span class="p">))</span> 
<span class="n">allusers</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">textFile</span><span class="p">(</span><span class="n">datapath</span><span class="p">(</span><span class="s1">'allUsers/'</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As a kind of preliminary "sanity check" let's extract favorite counts from posts and consider the ratio of upvotes to votes on that post. First, a function to extract favorites and votes, called <code>findFavorites</code>, from the lines of the <code>allvotes</code> dataset will need to be made. Lines in this dataset are small enough to write a regex search including the template of the entries; we'll write one to capture <code>Id</code>, <code>PostId</code>, and <code>VoteTypeId</code>. Then, <code>VoteTypeId</code> will be parsed into dummy valued 3-tuples (for ease in aggregating), <code>vote</code>,  based on the association <code>'2'</code>==<code>upvote</code>, <code>'3'</code>==<code>downvote</code>, and <code>'5'</code>==<code>favorite</code>. This function will spit out a tuple otf <code>(PostId, vote)</code> to be reduced.</p>
<ul>
<li>Apply <code>findFavorites</code> to each line with <code>map</code> and make sure to <code>filter</code> out <code>None</code> returns. </li>
<li><code>reduceByKey</code> will then collect all tuples with the same key (<code>PostId</code>), and we tell it to add them together. </li>
<li>Then, switch the order so the we have <code>(fav, (upvote, downvote))</code> as the key, value pair, </li>
<li><code>reduceByKey</code>, where key is <code>favCount</code>, by addition again, yielding <code>(favCount, (totalUpVote, totalDownVote))</code></li>
<li><code>mapValues</code> to transform the values <code>(totalUP, totalDOWN)=(x,y)</code> into the ratio <code>upVotes:totalVotes</code></li>
<li>return top 50 tuples ordered by upvote ratio.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">findFavorites</span> <span class="p">(</span><span class="n">input_string</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">'Id="([0-9]+)"\sPostId="([0-9]+)"[UserId\="0-9\s]+VoteTypeId="([235])"'</span><span class="p">,</span> <span class="n">input_string</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">vote</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">vote_val</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vote_val</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">'2'</span><span class="p">:</span>
            <span class="n">vote</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vote_val</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">'3'</span><span class="p">:</span>
            <span class="n">vote</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vote_val</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">'5'</span><span class="p">:</span>
            <span class="n">vote</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">vote</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    
<span class="n">results</span> <span class="o">=</span> <span class="n">allvotes</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">findFavorites</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>\
        <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>\
        <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>\
        <span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">))</span>\
        <span class="o">.</span><span class="n">takeOrdered</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's tempting to simply transform each entry into a <code>(favCount, upVote/totalVote)</code> tuple and do a regression analysis, actually modeling the relationship and enabling prediction. But since we lost the total vote count in the transformation, it wouldn't make a lot of sense to do this since surely <code>favCount</code> is just as dependent on total votes, and it doesn't make much sense modeling the <code>upRatio</code> as the dependent variable.</p>
<p>Would <code>upRatio</code> be a significant factor in a model already including <code>totalVotes</code>? If so, how much predictive power would adding it provide? These are interesting questions.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reputation-by-postTypeRatio">Reputation by postTypeRatio<a class="anchor-link" href="#Reputation-by-postTypeRatio">¶</a></h2><p>This is a very similar calculation to the sanity check above. We'll write a couple functions:</p>
<ul>
<li><code>user_reps</code> to extract <code>userId</code> and <code>Reputation</code> from the <code>allUsers</code> dataset, and </li>
<li><code>post_type</code> to extract <code>OwnerUserId</code> and whether the post was a question or answer from the <code>allPosts</code> dataset</li>
</ul>
<p>Most of the work is just a repetition of <code>map</code>, <code>filter</code>, and <code>reduceByKey</code> like in the sanity check, except this time we'll end by joining the two datasets to pair the top reputations with the <code>postTypeRatio</code>.</p>
<ul>
<li><code>top_users</code> will produce a list of tuples with <code>(userId, Reputation)</code></li>
<li><code>posts</code> will produce an RDD of tuples with <code>(userId, answerCount/postCount)</code></li>
<li>the join is done on keys, then we take the <code>Reputation</code> and <code>ratio</code>. </li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">user_reps</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">'Id'</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">'Reputation'</span><span class="p">]))</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>
    
<span class="k">def</span> <span class="nf">post_type</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>
        <span class="c1">#select questions</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">'PostTypeId'</span><span class="p">]</span><span class="o">==</span><span class="s1">'1'</span><span class="p">:</span>
            <span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1">#select answers</span>
        <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">'PostTypeId'</span><span class="p">]</span><span class="o">==</span><span class="s1">'2'</span><span class="p">:</span>
            <span class="n">a</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">'OwnerUserId'</span><span class="p">],</span><span class="n">a</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span><span class="p">,</span><span class="s1">'NA'</span>
    
    

<span class="n">top_users</span> <span class="o">=</span> <span class="n">allusers</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">user_reps</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">takeOrdered</span><span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    
<span class="n">posts</span> <span class="o">=</span> <span class="n">allposts</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">post_type</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>\
        <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])))</span>

<span class="n">topusers_stat</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">top_users</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Average-Reputation-by-postCount">Average Reputation by postCount<a class="anchor-link" href="#Average-Reputation-by-postCount">¶</a></h2><p>This time, we'll consider the user's <code>postCount</code> as the key, and average <code>Reputation</code> as the value. Though we already have the functions we need to extract the relevant data, we'll have to figure out how to find the average within our map/reduce sequence.</p>
<ul>
<li><code>id_post</code> just goes through each post in <code>allPosts</code> and attributes single posts to the owner's user id. </li>
<li><code>posts_by_id</code> maps <code>id_post</code> onto <code>allPosts</code>, and then we reduceByKey to sum them all up to get post counts</li>
<li><code>rep_by_tenure</code> is where the magic happens. Once we have the join of the two, tuples of <code>(id,(reputation,count))</code> </li>
</ul>
<h4 id="Averaging-values-over-a-key">Averaging values over a key<a class="anchor-link" href="#Averaging-values-over-a-key">¶</a></h4><p>To average (K,V) pairs by key, we'll need to keep track of both the <em>sum</em> and the <em>count</em> of the values passing through aggregator. To do this, we use <code>aggregateByKey</code>, which takes 3 arguments</p>
<ul>
<li>an initial value: <code>(0,0)</code> for us, since we're keeping track of sum and count</li>
<li>a <em>within</em> partition reduction function: <code>lambda a,b: (a[0] + b,    a[1] + 1)</code> <ul>
<li><code>a</code> is a tuple <code>(runningSum,runningCount)</code></li>
<li><code>b</code> is the next value in the parition</li>
</ul>
</li>
<li>a <em>between</em> paritition reduction function: <code>lambda a,b: (a[0] + b[0], a[1] + b[1]))</code> <ul>
<li><code>a</code> is the same tuple as before, but not we're aggregating accross partitions, not just within them</li>
<li><code>b</code> is a tuple <code>(nextPartitionSum, nextPartitionCount)</code></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">id_post</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">'OwnerUserId'</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>

<span class="n">posts_by_id</span> <span class="o">=</span> <span class="n">allposts</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">id_post</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>

<span class="n">rep_by_tenure</span> <span class="o">=</span> <span class="n">allusers</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">user_reps</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span>\
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posts_by_id</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>\
                <span class="o">.</span><span class="n">aggregateByKey</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span>    <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>\
                <span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>\
                <span class="o">.</span><span class="n">takeOrdered</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comparing-short-term-and-long-term-users">Comparing short-term and long-term users<a class="anchor-link" href="#Comparing-short-term-and-long-term-users">¶</a></h2><p>This distinction is a bit reductionist, but in practice we have to produce a well-defined metric for measuring some high-level, relatively abstract thing. Often times, there are numerous candidates for such metrics, and multiple implementations of each. These implementations are opportunities to tune the metric to determine the hyper-parameters (so to speak) which make them the most effective.</p>
<p>Here we'll call a <code>vetran</code> user one that is <em>active</em> in a window of 100-150 days from their account creation. We'd like to compare the first post of vetran users to non-vetran users, and see if there is a difference. Active - will mean that they have made a post of any kind in the specified window (we could also consider votes to count, too).</p>
<p><strong>NOTE</strong> I feel like this is a great opportunity to talk about something that is often not talked about in data-science posts, or even books, and that is the tool of hypothesis testing. I'm going to discuss this issue in a later post, however... so, stay tuned!</p>
<h4 id="Extraction-Functions">Extraction Functions<a class="anchor-link" href="#Extraction-Functions">¶</a></h4><ul>
<li><code>acct_creation</code> extracts <code>(Id, CreationDate)</code> from the <code>allUsers</code> dataset :: <code>user_list</code></li>
<li><code>post_date</code> extracts (<code>OwnerUserId</code>, <code>postDate</code>) from the <code>allPosts</code> dataset :: <code>posts_by_users</code></li>
<li><code>in_window</code> determines if any date in a list of postDates falls within 100-150 days of the owner's account creation from the join of <code>user_list</code> and <code>posts_by_users</code></li>
<li><code>post_info</code> extracts <code>(OwnerUserId, CreationDate, Score, ViewCount, AnswerCount, FavoriteCount)</code> from <code>allPosts</code></li>
</ul>
<h4 id="Mapping/Reducing">Mapping/Reducing<a class="anchor-link" href="#Mapping/Reducing">¶</a></h4><p>Remember, what we're attempting to get is summary statistics about the first post from users in each group.</p>
<ul>
<li><code>acct_creation</code> is simply applied to <code>allUsers</code></li>
<li><code>post_date</code> is applied to <code>allPosts</code>, and are then grouped by key (<code>userId</code>) to obtain a list of post dates by each user</li>
<li>we then join the previous two applications to obtain <code>(Id, (CreationDate,[postDate list]))</code> and apply <code>in_window</code> to get <code>vet_status</code></li>
<li><code>first_post_info</code> is obtained by mapping <code>allPosts</code> onto the summary space with the <code>post_info</code> function where they're then grouped by <code>OwnerUserId</code> and the values (a tuple of post info for all user posts) are list-ified, and we take the values associated with the post that has the earliest date, excluding <code>CreationDate</code>.</li>
<li><code>vet_status</code> gets joined to <code>first_post_info</code> on <code>userId</code>, which is then discarded. The rest is just averaging the first post info by group, as in the previous problem. </li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">user_list</span> <span class="o">=</span> <span class="n">allusers</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">acct_creation</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span>
<span class="n">posts_by_users</span> <span class="o">=</span> <span class="n">allposts</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">post_date</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="n">vet_status</span> <span class="o">=</span> <span class="n">user_list</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">posts_by_users</span><span class="p">)</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="n">in_window</span><span class="p">)</span>

<span class="n">first_post_info</span> <span class="o">=</span> <span class="n">allposts</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">post_info</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span><span class="o">.</span><span class="n">groupByKey</span><span class="p">()</span><span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>\
                  <span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]))][</span><span class="mi">1</span><span class="p">:])</span>
    
<span class="n">vet_status</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">first_post_info</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>\
          <span class="o">.</span><span class="n">aggregateByKey</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>\
          <span class="o">.</span><span class="n">mapValues</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Word2Vec-applications">Word2Vec applications<a class="anchor-link" href="#Word2Vec-applications">¶</a></h2><p>As promised, here we'll play around with <code>Word2Vec</code> and fimally get to some machine learning.</p>
<h3 id="Terms-related-to-'ggplot2'">Terms related to 'ggplot2'<a class="anchor-link" href="#Terms-related-to-'ggplot2'">¶</a></h3><p>This is hella easy: <code>word2vec</code> has it's own <code>findSynonyms</code> method which employs cosine similarity. So, all that we have to do is extract the relevant portion of the <code>allPosts</code> dataset and train a <code>word2vect</code> model on them.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.mllib.feature</span> <span class="kn">import</span> <span class="n">Word2Vec</span>

<span class="k">def</span> <span class="nf">tags</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">'PostTypeId'</span><span class="p">]</span><span class="o">==</span><span class="s1">'1'</span><span class="p">:</span>        
            <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">'Tags'</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'><'</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>
    
<span class="n">tag</span> <span class="o">=</span> <span class="n">fullposts</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="p">()</span><span class="o">.</span><span class="n">setVectorSize</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">setSeed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">findSynonyms</span><span class="p">(</span><span class="s1">'ggplot2'</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Predicting-tags-from-body-text">Predicting tags from body text<a class="anchor-link" href="#Predicting-tags-from-body-text">¶</a></h2><p>The punchline. Finally. As usual, there are a few steps to this problem. Technically this is a multi-label classification problem, but to simplify things we'll use a one-vs-all approach where we choose the top k most
common tags and train k binary classifiers where the labels indicate the presence or absence of that tag. In doing so, we'll first need to find those most common tags: <code>tag_count</code> and <code>pop_tags</code> accomplishes this.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="kn">import</span> <span class="nn">dill</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">Row</span>
<span class="kn">from</span> <span class="nn">pyspark.ml</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.feature</span> <span class="kn">import</span> <span class="n">HashingTF</span><span class="p">,</span> <span class="n">Tokenizer</span>


<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">allposts</span><span class="o">.</span><span class="n">randomSplit</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>


<span class="sd">'''get tags, find 100 common used'''</span>
<span class="k">def</span> <span class="nf">tag_count</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">'PostTypeId'</span><span class="p">]</span><span class="o">==</span><span class="s1">'1'</span><span class="p">:</span>        
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">'Tags'</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'><'</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>
    
<span class="n">pop_tags</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">tag_count</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span><span class="o">.</span><span class="n">reduceByKey</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span><span class="o">.</span><span class="n">takeOrdered</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">pop_tags</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">pop_tags</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>


<span class="sd">'''to extract body of question and associated tags'''</span>
<span class="n">w</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[\w']+"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">body_tags</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">'PostTypeId'</span><span class="p">]</span><span class="o">==</span><span class="s1">'1'</span><span class="p">:</span>        
            <span class="k">return</span> <span class="p">(</span><span class="s1">' '</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">w</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">'Body'</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">';'</span><span class="p">,</span><span class="s1">' '</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">></span><span class="mi">2</span><span class="p">]),</span> <span class="n">d</span><span class="p">[</span><span class="s1">'Tags'</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'><'</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s1">'NA'</span>

<span class="n">testingdata</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">body_tags</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],)),</span><span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s1">'text'</span><span class="p">])</span>
<span class="n">testingdata</span> <span class="o">=</span> <span class="n">hashingTF</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testingdata</span><span class="p">))</span>
<span class="n">traintag</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">body_tags</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">!=</span><span class="s1">'NA'</span><span class="p">)</span>

<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">"words"</span><span class="p">)</span>
<span class="n">hashingTF</span> <span class="o">=</span> <span class="n">HashingTF</span><span class="p">(</span><span class="n">inputCol</span><span class="o">=</span><span class="s2">"words"</span><span class="p">,</span> <span class="n">outputCol</span><span class="o">=</span><span class="s2">"features"</span><span class="p">)</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">pop_tags</span><span class="p">:</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">traintag</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Row</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">else</span> <span class="n">Row</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span><span class="n">schema</span><span class="o">=</span><span class="p">[</span><span class="s1">'label'</span><span class="p">,</span><span class="s1">'text'</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">hashingTF</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">temp</span><span class="p">))</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">temp</span><span class="p">[[</span><span class="s1">'label'</span><span class="p">,</span><span class="s1">'features'</span><span class="p">]]</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">"label"</span><span class="p">,</span> <span class="n">temp</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">DoubleType</span><span class="p">())),</span><span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">'maxIter'</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">'regParam'</span><span class="p">:</span><span class="mf">0.01</span><span class="p">})</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">testingdata</span><span class="p">)</span>
    <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">tag</span><span class="p">,</span><span class="n">predictions</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">probability</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">collect</span><span class="p">()))</span>
    
<span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span><span class="nb">open</span><span class="p">(</span><span class="s1">'OMG FILEPATH HERE'</span><span class="p">,</span><span class="s1">'w'</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>

<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        " linebreaks: { automatic: true, width: '95% container' }, " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://lgoerl.github.io/suncode-hackathon.html" rel="bookmark"
                           title="Permalink to SunCode Hackathon 2017">SunCode Hackathon 2017</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-04-09T08:21:00-07:00">
                Published: Sun 09 April 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://lgoerl.github.io/author/lee-goerl.html">Lee Goerl</a>
        </address>
<p>In <a href="https://lgoerl.github.io/category/posts.html">posts</a>.</p>
<p>tags: <a href="https://lgoerl.github.io/tag/personal.html">personal</a> <a href="https://lgoerl.github.io/tag/projects.html">projects</a> </p>
</footer><!-- /.post-info -->                
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Myth-of-Clean-Coal">The Myth of Clean Coal<a class="anchor-link" href="#The-Myth-of-Clean-Coal">¶</a></h1><h4 id="links">links<a class="anchor-link" href="#links">¶</a></h4><ul>
<li><a href="https://github.com/BBischof/suncode-hackathon">github</a> </li>
<li><a href="https://devpost.com/software/clean-coal-ljti0z">devpost</a></li>
</ul>
<p>  This weekend (Friday and Saturday, April 8th) I participated in <a href="https://suncode2017.devpost.com/">Powerhouse's SunCode 2017 Hackathon</a> in a team of 5: engineers Bryan Bischof and Jeff Larson, and industry professionals Caroline Whittinghill and Geoff Cotter. To moderate amusement and confusion of the rest of the room, we named ourselves CLEAN COAL - you know, the joke. This was my first hackathon, so I didn't really have any expectations, but to save you the suspense, I did leave pretty disappointed. Also, exhausted, smelly, and very dehydrated.</p>
                <a class="readmore" href="https://lgoerl.github.io/suncode-hackathon.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://lgoerl.github.io/hello-world.html" rel="bookmark"
                           title="Permalink to Hello World">Hello World</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-04-04T16:21:00-07:00">
                Published: Tue 04 April 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://lgoerl.github.io/author/lee-goerl.html">Lee Goerl</a>
        </address>
<p>In <a href="https://lgoerl.github.io/category/posts.html">posts</a>.</p>
<p>tags: <a href="https://lgoerl.github.io/tag/personal.html">personal</a> </p>
</footer><!-- /.post-info -->                
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Hello-World!">Hello World!<a class="anchor-link" href="#Hello-World!">¶</a></h2><p><br /></p>
<p>If you haven't gathered from the ubiquitious title, this is my first post.</p>
<p>I hope to use this blog to write about my professional journey, as I make the transition from my previous life in academia to the private sector-- and the world of data science-- and the inevitable personal life events and reflection that happens in between.</p>
                <a class="readmore" href="https://lgoerl.github.io/hello-world.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://quasicoherentlabs.com">QuasiCoherent Labs</a></li>
                            <li><a href="http://bbischof.com/">Bryan Bischof</a></li>
                            <li><a href="http://ericbunch.org">Eric Bunch</a></li>
                            <li><a href="https://willchernoff.com">Will Chernoff</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://lgoerl.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://twitter.com/lgoerl">twitter</a></li>
                            <li><a href="https://www.instagram.com/hruimfinethx/">instagram</a></li>
                            <li><a href="https://linkedin.com/in/lgoerl">linkedin</a></li>
                            <li><a href="https://github.com/lgoerl">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>